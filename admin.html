<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | All Bookings</title>
    <link rel="stylesheet" href="admin.css"> 
</head>
<body class="admin-page-body">
    <div class="admin-container">
        <h1 class="main-title">NOVIS GYM BOOKINGS</h1>
        <div class="total-bookings-count">Total Confirmed Bookings: <span id="bookingCount">0</span></div>
        
        <div class="table-wrapper">
            <table id="bookingsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Client Name</th>
                        <th>Package</th>
                        <th>Trainer</th>
                        <th>Start Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        
        <button class="back-btn" onclick="window.location.href='bookagain.html'">‚Üê Back to Confirmation</button>
    </div>

    <script>
        const STORAGE_KEY_ALL_BOOKINGS = 'novisGymAllBookings';
        const STORAGE_KEY_SELECTIONS = 'novisGymSelections';
        const STORAGE_KEY_CURRENT_EDIT = 'novisGymEditingBookingId';

        function loadBookings() {
            const bookings = JSON.parse(localStorage.getItem(STORAGE_KEY_ALL_BOOKINGS)) || [];
            const tbody = document.getElementById('bookingsTable').querySelector('tbody');
            const bookingCount = document.getElementById('bookingCount');
            tbody.innerHTML = ''; 
            
            bookingCount.textContent = bookings.length;

            if (bookings.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="no-data">No bookings found.</td></tr>`;
                return;
            }

            bookings.forEach(booking => {
                const row = tbody.insertRow();
                row.insertCell().textContent = booking.id.substring(booking.id.length - 5); 
                row.insertCell().textContent = booking.clientName;
                row.insertCell().textContent = booking.packageDisplay || booking.packageValue;
                row.insertCell().textContent = booking.trainerDisplay ? booking.trainerDisplay.split(' (')[0] : booking.trainerValue;
                row.insertCell().textContent = booking.startDate;
                
                const actionsCell = row.insertCell();
                actionsCell.className = 'actions-cell';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.className = 'action-btn edit-btn';
                editBtn.onclick = () => editBooking(booking.id, booking);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.onclick = () => deleteBooking(booking.id);
                
                actionsCell.appendChild(editBtn);
                actionsCell.appendChild(deleteBtn);
            });
        }

        function deleteBooking(bookingId) {
            if (confirm(`Are you sure you want to delete this booking?`)) {
                let bookings = JSON.parse(localStorage.getItem(STORAGE_KEY_ALL_BOOKINGS)) || [];
                bookings = bookings.filter(booking => booking.id !== bookingId);
                localStorage.setItem(STORAGE_KEY_ALL_BOOKINGS, JSON.stringify(bookings));
                loadBookings(); 
                alert("Booking successfully deleted.");
            }
        }

        function editBooking(bookingId, bookingData) {
            localStorage.setItem(STORAGE_KEY_SELECTIONS, JSON.stringify(bookingData));
            localStorage.setItem(STORAGE_KEY_CURRENT_EDIT, bookingId); 
            window.location.href = "selection.html"; 
        }

        document.addEventListener('DOMContentLoaded', loadBookings);
    </script>
</body>
</html>